import React from 'react';
import styles from './Header.styles';
import Text from '../../atoms/Text';
import Title from '../../atoms/Title';
import { Pressable, View } from 'react-native';
import SendSOS from '../../molecules/SendSOS';
import SearchEngineInput from '../../molecules/SearchEngineInput';
import Icon from '../../atoms/Icon';
import useNavigation from '../../../hooks/useNavigation';
import AdvertiseServiceButton from '../../molecules/AdvertiseServiceButton';
import PAMSelector from '../../molecules/PAMSelector';
import { useUserStore } from '../../../store';

const Header = () => {
  const navigation = useNavigation();
  const { user, isPAM, isEnvironment, isAdvertiser } = useUserStore();

  return (
    <View style={styles.container}>
      <View style={styles.greetingContainer}>
        <View style={styles.userContainer}>
          <Text style={styles.hello}>Hola,</Text>
          <View style={styles.nameContainer}>
            <Title size="base" numberOfLines={1} style={styles.title}>
              {user?.username}
            </Title>
            {!isAdvertiser && (
              <Pressable
                onPress={() => navigation.navigate('Config')}
                style={styles.btnConfig}>
                <Icon
                  scale="22"
                  viewBox="0 0 20 20"
                  d="M11.5097 19.5H8.48092C8.25655 19.5 8.06232 19.4247 7.89822 19.274C7.73412 19.1234 7.6354 18.9359 7.60207 18.7115L7.31169 16.4538C7.04374 16.3641 6.76906 16.2384 6.48764 16.0769C6.20623 15.9154 5.95462 15.7423 5.73282 15.5577L3.64437 16.4384C3.43027 16.5218 3.21777 16.5301 3.00687 16.4634C2.79597 16.3968 2.63026 16.2647 2.50974 16.0673L1.00594 13.4481C0.885426 13.2506 0.848568 13.0398 0.895368 12.8154C0.942151 12.591 1.05593 12.4103 1.23669 12.2731L3.04439 10.9058C3.02131 10.7571 3.00496 10.6077 2.99534 10.4577C2.98573 10.3077 2.98092 10.1583 2.98092 10.0096C2.98092 9.86732 2.98573 9.72276 2.99534 9.57596C3.00496 9.42916 3.02131 9.26858 3.04439 9.09423L1.23669 7.72691C1.05593 7.58974 0.942151 7.40897 0.895368 7.18461C0.848568 6.96026 0.885426 6.74937 1.00594 6.55193L2.50974 3.95198C2.62001 3.74428 2.78155 3.60966 2.99437 3.54813C3.20719 3.4866 3.42064 3.4975 3.63474 3.58083L5.72319 4.45198C5.96423 4.26095 6.2216 4.08626 6.49532 3.92793C6.76905 3.76958 7.03797 3.64233 7.30207 3.54618L7.60207 1.28851C7.6354 1.06414 7.73412 0.876639 7.89822 0.726006C8.06232 0.575356 8.25655 0.500031 8.48092 0.500031H11.5097C11.7341 0.500031 11.9299 0.575356 12.0972 0.726006C12.2645 0.876639 12.3648 1.06414 12.3982 1.28851L12.6885 3.55581C12.9885 3.66477 13.26 3.79201 13.503 3.93753C13.7459 4.08305 13.9911 4.25453 14.2386 4.45198L16.3655 3.58083C16.5796 3.4975 16.7905 3.48756 16.9982 3.55101C17.2059 3.61447 17.37 3.74492 17.4905 3.94236L18.9943 6.55193C19.1148 6.74937 19.1517 6.96026 19.1049 7.18461C19.0581 7.40897 18.9443 7.58974 18.7635 7.72691L16.9174 9.12306C16.9533 9.28461 16.9728 9.43557 16.976 9.57596C16.9792 9.71634 16.9808 9.85769 16.9808 10C16.9808 10.1359 16.9776 10.274 16.9712 10.4144C16.9648 10.5548 16.9417 10.7154 16.902 10.8962L18.7289 12.2731C18.9161 12.4039 19.0315 12.583 19.0751 12.8106C19.1187 13.0381 19.0802 13.2506 18.9597 13.4481L17.4559 16.0519C17.3354 16.2493 17.1671 16.3823 16.9511 16.4509C16.735 16.5195 16.52 16.5121 16.3059 16.4288L14.2386 15.548C13.9911 15.7455 13.7386 15.9202 13.4809 16.0721C13.2232 16.224 12.9591 16.3481 12.6885 16.4442L12.3982 18.7115C12.3648 18.9359 12.2645 19.1234 12.0972 19.274C11.9299 19.4247 11.7341 19.5 11.5097 19.5ZM10.0116 13C10.8437 13 11.5517 12.708 12.1357 12.124C12.7196 11.54 13.0116 10.832 13.0116 10C13.0116 9.16797 12.7196 8.45997 12.1357 7.87598C11.5517 7.29202 10.8437 7.00003 10.0116 7.00003C9.16936 7.00003 8.45879 7.29202 7.87994 7.87598C7.30111 8.45997 7.01169 9.16797 7.01169 10C7.01169 10.832 7.30111 11.54 7.87994 12.124C8.45879 12.708 9.16936 13 10.0116 13ZM10.0116 11.5C9.59498 11.5 9.24081 11.3542 8.94914 11.0625C8.65748 10.7708 8.51164 10.4167 8.51164 10C8.51164 9.58334 8.65748 9.22917 8.94914 8.93751C9.24081 8.64584 9.59498 8.50001 10.0116 8.50001C10.4283 8.50001 10.7825 8.64584 11.0741 8.93751C11.3658 9.22917 11.5116 9.58334 11.5116 10C11.5116 10.4167 11.3658 10.7708 11.0741 11.0625C10.7825 11.3542 10.4283 11.5 10.0116 11.5ZM9.00012 18H10.9655L11.3251 15.3212C11.8354 15.1878 12.3017 14.9984 12.7241 14.7529C13.1466 14.5074 13.554 14.1917 13.9463 13.8058L16.4309 14.85L17.4155 13.15L15.2463 11.5154C15.3296 11.2564 15.3863 11.0026 15.4165 10.7539C15.4466 10.5051 15.4616 10.2539 15.4616 10C15.4616 9.73976 15.4466 9.48847 15.4165 9.24616C15.3863 9.00386 15.3296 8.75642 15.2463 8.50386L17.4347 6.85001L16.4501 5.15001L13.9366 6.20963C13.602 5.85193 13.2011 5.53591 12.7338 5.26156C12.2665 4.98719 11.7937 4.79296 11.3155 4.67886L11.0001 2.00001H9.01549L8.68474 4.66923C8.17448 4.78975 7.70332 4.97436 7.27127 5.22308C6.83922 5.4718 6.42704 5.79232 6.03474 6.18463L3.55012 5.15001L2.56549 6.85001L4.72512 8.45963C4.64178 8.6968 4.58345 8.94359 4.55012 9.20001C4.51678 9.45642 4.50012 9.7263 4.50012 10.0096C4.50012 10.2699 4.51678 10.525 4.55012 10.775C4.58345 11.025 4.63858 11.2718 4.71549 11.5154L2.56549 13.15L3.55012 14.85L6.02512 13.8C6.4046 14.1898 6.81037 14.509 7.24242 14.7577C7.67447 15.0064 8.15204 15.1974 8.67512 15.3308L9.00012 18Z"
                />
              </Pressable>
            )}
          </View>
        </View>

        {isPAM && <SendSOS />}
        {isEnvironment && <PAMSelector />}
        {isAdvertiser && <AdvertiseServiceButton />}
      </View>

      {!isAdvertiser && (
        <Pressable
          onPress={() =>
            navigation.navigate('SearchEngine', { searchTerm: '' })
          }
          style={styles.input}>
          <SearchEngineInput editable={false} />
        </Pressable>
      )}
    </View>
  );
};

export default Header;
